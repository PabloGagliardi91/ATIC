# -*- coding: utf-8 -*-
"""SparkStreaming.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1ZrYLAnMmLeaF4LpmxWnhEiLwLIK79n0j

#TP3 - Spark Streaming
Una empresa de remises monitorea la geoposición de cada uno de sus vehículos en cada uno de los viajes realizados. La ciudad por donde realizan los viajes los vehículos de la empresa es un cuadrado conformado por 100 avenidas verticales y 100 calles horizontales. Y la geolocalización se transmite del vehículo a la empresa cada vez que el propio vehículo llega a una intersección
entre una avenida y una calle.

Los autos generan un stream de datos con su geoposición. 

El stream posee los siguientes atributos: 

> ***(ID_vehículo, Avenida, Calle, Timestamp, Destino).***

Los scripts en Spark deben permitir el monitoreo de la información pedida en cada enunciado, cada un cierto intervalo de tiempo (por ejemplo, cada 15 segundos). La información solicitada debe ser histórica, desde el comienzo de la escucha del stream.
"""

# Instalamos Spark para Python
!pip install pyspark

import os

# Instalamos Java SDK 8
!apt-get install -y openjdk-8-jdk -qq > /dev/null      
!echo $(/usr/libexec/java_home -v 1.8)

#set environment variable
os.environ["JAVA_HOME"] = "/usr/lib/jvm/java-8-openjdk-amd64"     
!echo 2 | update-alternatives --config java

# Montamos Drive en este Notebook para acceder a los archivos
# "My Drive" es la raiz de drive ("Mi unidad")

root_path = 'drive/My Drive/Colab Notebooks/Streaming/'

from google.colab import drive
drive.mount('/content/drive', force_remount=True)

# Creamos el contexto de Spark
from pyspark import SparkContext
sc = SparkContext("local", "SparkStreaming")

from pyspark.streaming import StreamingContext
ssc = StreamingContext(sc, 15)

ssc.checkpoint("buffer")

"""## 1) Implemente un script de Spark que permita conocer cuántos viajes realizó cada vehículo.
Recordar que un viaje es una serie de coordenadas que finalizan en un destino
determinado.

Ejemplo:

> ![image.png](data:image/png;base64,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)
"""

# Transformaciones
def fUpdate(newValues, history):
  if (history == None):
    history = 0
  if (newValues == None):
    newValues = 0
  else:
    newValues = sum(newValues)
  return history + newValues
  
stream = ssc.textFileStream(root_path)
counts = stream.map(lambda t: t.split('\t'))\
              .filter(lambda t: t[4] != "") \
              .map(lambda t: (t[0], 1))\
              .reduceByKey(lambda a, b: a + b)
history = counts.updateStateByKey(fUpdate)
history.pprint()
ssc.start()
ssc.awaitTermination()

"""## 2) Implemente un script de Spark que permita conocer cuál es la esquina “promedio” entre todas las esquinas cuyo destino es “Otro”.

Ejemplo:

> ![image.png](data:image/png;base64,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)
"""

def fUpdate(newValues, history):
  if (history == None):
    history = (0, 0, 0)
  if (newValues == None):
    newValues = (0, 0, 0)
  else:
    avenidas = [field[0] for field in newValues]
    calles = [field[1] for field in newValues]
    count = [field[2] for field in newValues]
    newValues = (sum(avenidas), sum(calles), sum(count))
  return (history[0] + newValues[0], history[1] + newValues[1], history[2] + newValues[2]) 

# aggregate zero value : (key, sum_av, sum_ca, count_esq)
stream = ssc.textFileStream(root_path)
counts = stream.map(lambda t: t.split('\t'))\
              .filter(lambda t: t[4] == "Otro") \
              .map(lambda t: (1, (int(t[0]), int(t[1]), 1)) )\
              .reduceByKey(lambda v1, v2: (v1[0]+v2[0], v1[1]+v2[1], v1[2]+v2[2]))
              # .aggregate((1, 0, 0, 0),
              #            (lambda res, ori: (1, res[1]+ori[0], res[2]+ori[1], res[3]+1)),
              #            (lambda r1, r2: (1, r1[1]+r2[1], r1[2]+r2[2], r1[3]+r2[3])))
history = counts.updateStateByKey(fUpdate)
history.pprint()
prom = history.map(lambda t: (round(t[1][0] / t[1][2],2), round(t[1][1]/ t[1][2],2)))
prom.pprint()
ssc.start()
ssc.awaitTermination()